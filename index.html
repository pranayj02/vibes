<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Izzu‚Äôs Bunking Powertool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #fefeff;
      --card: #ffffff;
      --text: #333;
      --attended: #c8f7c5;
      --bunked: #f9c0c0;
      --upcoming: #e0e0e0;
    }
    body.dark {
      --bg: #1e1e2f;
      --card: #2c2c3e;
      --text: #eee;
      --attended: #2e8b57;
      --bunked: #8b2e2e;
      --upcoming: #555;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 20px;
      transition: all 0.3s ease;
    }
    header {
      text-align: center;
      margin-bottom: 10px;
    }
    .toggle-dark {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #ffd93d;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
    }
    .carousel-container {
      max-width: 600px;
      margin: 0 auto 20px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .carousel-image {
      display: none;
      width: 100%;
      border-radius: 12px;
    }
    .subject-card {
      background: var(--card);
      border-radius: 10px;
      padding: 12px;
      margin: 10px auto;
      max-width: 700px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    .calendar {
      margin-top: 30px;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      margin-top: 10px;
    }
    .calendar-day {
      background: var(--card);
      border-radius: 8px;
      padding: 6px;
      min-height: 80px;
      font-size: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .calendar-day h4 {
      margin: 0 0 4px;
    }
    .class-button {
      display: block;
      margin: 2px 0;
      font-size: 11px;
      padding: 2px 4px;
      border-radius: 5px;
      cursor: pointer;
      text-align: center;
    }
    .attended { background: var(--attended); }
    .bunked { background: var(--bunked); }
    .upcoming { background: var(--upcoming); }
    .legend {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 10px;
    }
    .legend span {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
    .dot.attended { background: var(--attended); }
    .dot.bunked   { background: var(--bunked); }
    .dot.upcoming { background: var(--upcoming); }
  </style>
</head>
<body>
  <button class="toggle-dark" onclick="toggleDarkMode()">üåô Toggle</button>
  <header>
    <h1>Izzu‚Äôs Bunking Powertool</h1>
  </header>

  <div class="carousel-container">
    <img class="carousel-image" src="FE587BEE-B75A-4339-A4FC-4BDBE073A250.jpeg" />
    <img class="carousel-image" src="IMG_0330.jpeg" />
    <img class="carousel-image" src="IMG_3484.jpeg" />
    <img class="carousel-image" src="IMG_5178.jpeg" />
    <img class="carousel-image" src="IMG_5179.jpeg" />
    <img class="carousel-image" src="IMG_5180.jpeg" />
  </div>

  <div id="subjectStats"></div>

  <div class="calendar">
    <div class="calendar-header">
      <button onclick="changeMonth(-1)">‚Üê Prev</button>
      <h2 id="monthLabel"></h2>
      <button onclick="changeMonth(1)">Next ‚Üí</button>
    </div>
    <div class="calendar-grid" id="calendarGrid"></div>
    <div class="legend">
      <span><div class="dot attended"></div>Attended</span>
      <span><div class="dot bunked"></div>Bunked</span>
      <span><div class="dot upcoming"></div>Upcoming</span>
    </div>
  </div>

  <script>
    const subjects = {
      "Design Dissertation - 1": [1],
      "Environmental Studies - 4": [1],
      "Arch. Design Studio - 8": [2, 3],
      "Theory & Design of Structures - 8": [3],
      "Allied Studio ‚Äì Town Planning": [4, 5],
      "Prof. Practice - 2": [4],
      "Building Construction - 8": [5],
      "Building Services - 6": [4],
    };
    const holidays = ["2025-08-15", "2025-09-19", "2025-10-02"];
    const start = new Date("2025-06-10");
    const end = new Date("2025-10-03");
    let viewMonth = start.getMonth();
    let viewYear = start.getFullYear();
    const storageKey = 'izzus-attendance';
    const attendance = JSON.parse(localStorage.getItem(storageKey) || '{}');

    function saveData() {
      localStorage.setItem(storageKey, JSON.stringify(attendance));
    }

    function getAllDates() {
      const out = [];
      let d = new Date(start);
      while (d <= end) {
        out.push(new Date(d));
        d.setDate(d.getDate() + 1);
      }
      return out;
    }

    function formatDate(d) {
      return d.toISOString().slice(0, 10);
    }

    function toggleStatus(subject, dateStr) {
      const key = `${subject}_${dateStr}`;
      attendance[key] = attendance[key] === 'attended' ? 'bunked' :
                        attendance[key] === 'bunked' ? 'attended' : 'attended';
      saveData();
      render();
    }

    function renderStats() {
      const container = document.getElementById("subjectStats");
      container.innerHTML = '';
      Object.entries(subjects).forEach(([subject, days]) => {
        let total = 0, attended = 0, bunked = 0;
        getAllDates().forEach(date => {
          const dStr = formatDate(date);
          if (days.includes(date.getDay()) && !holidays.includes(dStr)) {
            total++;
            const key = `${subject}_${dStr}`;
            if (attendance[key] === 'attended') attended++;
            if (attendance[key] === 'bunked') bunked++;
          }
        });
        const required = Math.ceil(0.75 * total);
        const canBunk = Math.max(0, attended + (total - attended - bunked) - required);
        const mustAttend = Math.max(0, required - attended);
        const div = document.createElement('div');
        div.className = 'subject-card';
        div.innerHTML = `
          <h3>${subject}</h3>
          <p>Held: ${attended + bunked} / ${total} | Attended: ${attended} | Bunked: ${bunked}</p>
          <p>Can still bunk: ${canBunk} | Must attend: ${mustAttend}</p>
        `;
        container.appendChild(div);
      });
    }

    function renderCalendar() {
      const grid = document.getElementById("calendarGrid");
      grid.innerHTML = '';
      const label = document.getElementById("monthLabel");
      const first = new Date(viewYear, viewMonth, 1);
      const startDay = new Date(first);
      startDay.setDate(first.getDate() - first.getDay());
      label.textContent = first.toLocaleString('default', { month: 'long', year: 'numeric' });

      for (let i = 0; i < 42; i++) {
        const date = new Date(startDay);
        date.setDate(startDay.getDate() + i);
        const dStr = formatDate(date);
        const cell = document.createElement('div');
        cell.className = 'calendar-day';
        cell.innerHTML = `<h4>${date.getDate()}</h4>`;

        Object.entries(subjects).forEach(([subject, days]) => {
          if (days.includes(date.getDay()) && !holidays.includes(dStr)) {
            const key = `${subject}_${dStr}`;
            const status = attendance[key] || 'upcoming';
            const btn = document.createElement('div');
            btn.className = `class-button ${status}`;
            btn.textContent = subject.split(" ")[0].slice(0, 4);
            btn.onclick = () => toggleStatus(subject, dStr);
            cell.appendChild(btn);
          }
        });

        grid.appendChild(cell);
      }
    }

    function render() {
      renderStats();
      renderCalendar();
    }

    function changeMonth(offset) {
      viewMonth += offset;
      if (viewMonth < 0) { viewMonth = 11; viewYear--; }
      if (viewMonth > 11) { viewMonth = 0; viewYear++; }
      render();
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark");
    }

    function rotateCarousel() {
      const imgs = document.querySelectorAll('.carousel-image');
      let idx = 0;
      setInterval(() => {
        imgs.forEach((img, i) => img.style.display = i === idx ? 'block' : 'none');
        idx = (idx + 1) % imgs.length;
      }, 3000);
    }

    rotateCarousel();
    render();
  </script>
</body>
</html>